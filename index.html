<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Mini-City Prototype</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        canvas { display: block; }
        
        /* UI Overlay */
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 8px;
            pointer-events: none;
        }

        /* Map Button */
        #map-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* Fullscreen Map Overlay */
        #map-overlay {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 300 shadowy;
            background: #333;
            border: 5px solid white;
            border-radius: 10px;
            z-index: 10;
        }
        
        .map-player-dot {
            width: 10px;
            height: 10px;
            background: red;
            position: absolute;
            border-radius: 50%;
        }
    </style>
</head>
<body>

    <div id="ui">WASD to Move | Click "View Map" to see position</div>
    <button id="map-btn" onclick="toggleMap()">VIEW MAP</button>
    <div id="map-overlay" onclick="toggleMap()">
        <div id="player-dot" class="map-player-dot"></div>
        <div style="color: white; text-align: center; margin-top: 130px;">CITY MAP</div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- SCENE SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb); // Sky blue

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // --- LIGHTING ---
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 10, 7.5);
        scene.add(light);
        scene.add(new THREE.AmbientLight(0x404040));

        // --- WORLD OBJECTS ---
        // Ground
        const groundGeo = new THREE.PlaneGeometry(100, 100);
        const groundMat = new THREE.MeshStandardMaterial({ color: 0x555555 });
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        // Simple Player
        const playerGeo = new THREE.BoxGeometry(1, 2, 1);
        const playerMat = new THREE.MeshStandardMaterial({ color: 0x00ff00 });
        const player = new THREE.Mesh(playerGeo, playerMat);
        player.position.y = 1;
        scene.add(player);

        // Some "Buildings"
        for(let i=0; i<10; i++) {
            const bGeo = new THREE.BoxGeometry(4, Math.random() * 10 + 2, 4);
            const bMat = new THREE.MeshStandardMaterial({ color: 0x777777 });
            const building = new THREE.Mesh(bGeo, bMat);
            building.position.set(Math.random() * 40 - 20, bGeo.parameters.height/2, Math.random() * 40 - 20);
            scene.add(building);
        }

        // --- MOVEMENT LOGIC ---
        const keys = {};
        window.addEventListener('keydown', (e) => keys[e.code] = true);
        window.addEventListener('keyup', (e) => keys[e.code] = false);

        const moveSpeed = 0.15;
        const playerDot = document.getElementById('player-dot');

        function update() {
            if (keys['KeyW']) player.position.z -= moveSpeed;
            if (keys['KeyS']) player.position.z += moveSpeed;
            if (keys['KeyA']) player.position.x -= moveSpeed;
            if (keys['KeyD']) player.position.x += moveSpeed;

            // Camera follows player
            camera.position.set(player.position.x, player.position.y + 10, player.position.z + 15);
            camera.lookAt(player.position);

            // Update Map UI position (Scaling world coords to map pixels)
            // 100 units world = 300px map
            const mapX = (player.position.x + 50) * 3;
            const mapY = (player.position.z + 50) * 3;
            playerDot.style.left = `${mapX}px`;
            playerDot.style.top = `${mapY}px`;
        }

        // --- ANIMATION LOOP ---
        function animate() {
            requestAnimationFrame(animate);
            update();
            renderer.render(scene, camera);
        }

        // Handle Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();

        // Map Toggle Global Function
        window.toggleMap = function() {
            const map = document.getElementById('map-overlay');
            map.style.display = (map.style.display === 'block') ? 'none' : 'block';
        };
    </script>
</body>
</html>
