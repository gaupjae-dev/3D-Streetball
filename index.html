<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Our Perfect Game - Prototype</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        #map-icon {
            position: absolute; top: 20px; right: 20px;
            width: 80px; height: 80px;
            background: rgba(0,0,0,0.7); border: 3px solid white;
            border-radius: 10px; cursor: pointer; color: white;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; z-index: 10;
        }
        #big-map {
            position: absolute; top: 10%; left: 10%;
            width: 80%; height: 80%;
            background: rgba(50, 50, 50, 0.9); border: 5px solid gold;
            display: none; z-index: 20; border-radius: 20px;
        }
        #ui { position: absolute; bottom: 20px; left: 20px; color: white; pointer-events: none; }
    </style>
</head>
<body>

    <div id="map-icon" onclick="toggleMap()">MAP</div>
    <div id="big-map" onclick="toggleMap()">
        <h2 style="text-align:center; color:white;">WORLD MAP</h2>
        <p style="text-align:center; color:white;">(Click anywhere to close)</p>
    </div>
    <div id="ui">
        WASD to Move | Q to Punch
    </div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // 1. SETUP THE WORLD
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB); // Sky Blue
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // 2. THE GROUND (Blank Map)
        const groundGeo = new THREE.PlaneGeometry(100, 100);
        const groundMat = new THREE.MeshStandardMaterial({ color: 0x228B22 }); // Grass Green
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        // 3. THE PLAYER (Third Person)
        const playerGeo = new THREE.BoxGeometry(1, 2, 1);
        const playerMat = new THREE.MeshStandardMaterial({ color: 0x0000ff });
        const player = new THREE.Mesh(playerGeo, playerMat);
        player.position.y = 1;
        scene.add(player);

        // 4. LIGHTING
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 10, 7.5);
        scene.add(light, new THREE.AmbientLight(0x404040));

        // 5. CONTROLS
        const keys = {};
        window.onkeydown = (e) => keys[e.key.toLowerCase()] = true;
        window.onkeyup = (e) => keys[e.key.toLowerCase()] = false;

        function update() {
            const speed = 0.1;
            if (keys['w']) player.position.z -= speed;
            if (keys['s']) player.position.z += speed;
            if (keys['a']) player.position.x -= speed;
            if (keys['d']) player.position.x += speed;

            // Q to Punch (Simple Scale Animation)
            if (keys['q']) {
                player.scale.z = 1.5; // "Arm" extends
            } else {
                player.scale.z = 1;
            }

            // Camera follow (Third Person Logic)
            camera.position.set(player.position.x, player.position.y + 4, player.position.z + 8);
            camera.lookAt(player.position);
        }

        function animate() {
            requestAnimationFrame(animate);
            update();
            renderer.render(scene, camera);
        }
        animate();

        // 6. UI LOGIC
        window.toggleMap = function() {
            const m = document.getElementById('big-map');
            m.style.display = m.style.display === 'block' ? 'none' : 'block';
        }
    </script>
</body>
</html>
